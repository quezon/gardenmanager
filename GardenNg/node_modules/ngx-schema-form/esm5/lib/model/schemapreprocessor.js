/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { isBlank } from './utils';
/**
 * @param {?} message
 * @param {?} path
 * @return {?}
 */
function formatMessage(message, path) {
    return "Parsing error on " + path + ": " + message;
}
/**
 * @param {?} message
 * @param {?} path
 * @return {?}
 */
function schemaError(message, path) {
    /** @type {?} */
    var mesg = formatMessage(message, path);
    throw new Error(mesg);
}
/**
 * @param {?} message
 * @param {?} path
 * @return {?}
 */
function schemaWarning(message, path) {
    /** @type {?} */
    var mesg = formatMessage(message, path);
    throw new Error(mesg);
}
var SchemaPreprocessor = /** @class */ (function () {
    function SchemaPreprocessor() {
    }
    /**
     * @param {?} jsonSchema
     * @param {?=} path
     * @return {?}
     */
    SchemaPreprocessor.preprocess = /**
     * @param {?} jsonSchema
     * @param {?=} path
     * @return {?}
     */
    function (jsonSchema, path) {
        if (path === void 0) { path = '/'; }
        jsonSchema = jsonSchema || {};
        SchemaPreprocessor.normalizeExtensions(jsonSchema);
        if (jsonSchema.type === 'object') {
            SchemaPreprocessor.checkProperties(jsonSchema, path);
            SchemaPreprocessor.checkAndCreateFieldsets(jsonSchema, path);
        }
        else if (jsonSchema.type === 'array') {
            SchemaPreprocessor.checkItems(jsonSchema, path);
        }
        SchemaPreprocessor.normalizeWidget(jsonSchema);
        SchemaPreprocessor.recursiveCheck(jsonSchema, path);
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    SchemaPreprocessor.checkProperties = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    function (jsonSchema, path) {
        if (isBlank(jsonSchema.properties)) {
            jsonSchema.properties = {};
            schemaWarning('Provided json schema does not contain a \'properties\' entry. Output schema will be empty', path);
        }
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    SchemaPreprocessor.checkAndCreateFieldsets = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    function (jsonSchema, path) {
        if (jsonSchema.fieldsets === undefined) {
            if (jsonSchema.order !== undefined) {
                SchemaPreprocessor.replaceOrderByFieldsets(jsonSchema);
            }
            else {
                SchemaPreprocessor.createFieldsets(jsonSchema);
            }
        }
        SchemaPreprocessor.checkFieldsUsage(jsonSchema, path);
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    SchemaPreprocessor.checkFieldsUsage = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    function (jsonSchema, path) {
        var e_1, _a, e_2, _b, e_3, _c;
        /** @type {?} */
        var fieldsId = Object.keys(jsonSchema.properties);
        /** @type {?} */
        var usedFields = {};
        try {
            for (var _d = tslib_1.__values(jsonSchema.fieldsets), _e = _d.next(); !_e.done; _e = _d.next()) {
                var fieldset = _e.value;
                try {
                    for (var _f = tslib_1.__values(fieldset.fields), _g = _f.next(); !_g.done; _g = _f.next()) {
                        var fieldId = _g.value;
                        if (usedFields[fieldId] === undefined) {
                            usedFields[fieldId] = [];
                        }
                        usedFields[fieldId].push(fieldset.id);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_1) throw e_1.error; }
        }
        try {
            for (var fieldsId_1 = tslib_1.__values(fieldsId), fieldsId_1_1 = fieldsId_1.next(); !fieldsId_1_1.done; fieldsId_1_1 = fieldsId_1.next()) {
                var fieldId = fieldsId_1_1.value;
                /** @type {?} */
                var isRequired = jsonSchema.required && jsonSchema.required.indexOf(fieldId) > -1;
                if (isRequired && jsonSchema.properties[fieldId]) {
                    jsonSchema.properties[fieldId].isRequired = true;
                }
                if (usedFields.hasOwnProperty(fieldId)) {
                    if (usedFields[fieldId].length > 1) {
                        schemaError(fieldId + " is referenced by more than one fieldset: " + usedFields[fieldId], path);
                    }
                    delete usedFields[fieldId];
                }
                else if (isRequired) {
                    schemaError(fieldId + " is a required field but it is not referenced as part of a 'order' or a 'fieldset' property", path);
                }
                else {
                    delete jsonSchema[fieldId];
                    schemaWarning("Removing unreferenced field " + fieldId, path);
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (fieldsId_1_1 && !fieldsId_1_1.done && (_c = fieldsId_1.return)) _c.call(fieldsId_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        for (var remainingfieldsId in usedFields) {
            if (usedFields.hasOwnProperty(remainingfieldsId)) {
                schemaWarning("Referencing non-existent field " + remainingfieldsId + " in one or more fieldsets", path);
            }
        }
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @return {?}
     */
    SchemaPreprocessor.createFieldsets = /**
     * @private
     * @param {?} jsonSchema
     * @return {?}
     */
    function (jsonSchema) {
        jsonSchema.order = Object.keys(jsonSchema.properties);
        SchemaPreprocessor.replaceOrderByFieldsets(jsonSchema);
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @return {?}
     */
    SchemaPreprocessor.replaceOrderByFieldsets = /**
     * @private
     * @param {?} jsonSchema
     * @return {?}
     */
    function (jsonSchema) {
        jsonSchema.fieldsets = [{
                id: 'fieldset-default',
                title: jsonSchema.title || '',
                description: jsonSchema.description || '',
                name: jsonSchema.name || '',
                fields: jsonSchema.order
            }];
        delete jsonSchema.order;
    };
    /**
     * @private
     * @param {?} fieldSchema
     * @return {?}
     */
    SchemaPreprocessor.normalizeWidget = /**
     * @private
     * @param {?} fieldSchema
     * @return {?}
     */
    function (fieldSchema) {
        /** @type {?} */
        var widget = fieldSchema.widget;
        if (widget === undefined) {
            widget = { 'id': fieldSchema.type };
        }
        else if (typeof widget === 'string') {
            widget = { 'id': widget };
        }
        fieldSchema.widget = widget;
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    SchemaPreprocessor.checkItems = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    function (jsonSchema, path) {
        if (jsonSchema.items === undefined) {
            schemaError('No \'items\' property in array', path);
        }
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    SchemaPreprocessor.recursiveCheck = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} path
     * @return {?}
     */
    function (jsonSchema, path) {
        if (jsonSchema.type === 'object') {
            for (var fieldId in jsonSchema.properties) {
                if (jsonSchema.properties.hasOwnProperty(fieldId)) {
                    /** @type {?} */
                    var fieldSchema = jsonSchema.properties[fieldId];
                    SchemaPreprocessor.preprocess(fieldSchema, path + fieldId + '/');
                }
            }
            if (jsonSchema.hasOwnProperty('definitions')) {
                for (var fieldId in jsonSchema.definitions) {
                    if (jsonSchema.definitions.hasOwnProperty(fieldId)) {
                        /** @type {?} */
                        var fieldSchema = jsonSchema.definitions[fieldId];
                        SchemaPreprocessor.removeRecursiveRefProperties(fieldSchema, "#/definitions/" + fieldId);
                        SchemaPreprocessor.preprocess(fieldSchema, path + fieldId + '/');
                    }
                }
            }
        }
        else if (jsonSchema.type === 'array') {
            SchemaPreprocessor.preprocess(jsonSchema.items, path + '*/');
        }
    };
    /**
     * @private
     * @param {?} jsonSchema
     * @param {?} definitionPath
     * @return {?}
     */
    SchemaPreprocessor.removeRecursiveRefProperties = /**
     * @private
     * @param {?} jsonSchema
     * @param {?} definitionPath
     * @return {?}
     */
    function (jsonSchema, definitionPath) {
        // to avoid infinite loop
        if (jsonSchema.type === 'object') {
            for (var fieldId in jsonSchema.properties) {
                if (jsonSchema.properties.hasOwnProperty(fieldId)) {
                    if (jsonSchema.properties[fieldId].$ref
                        && jsonSchema.properties[fieldId].$ref === definitionPath) {
                        delete jsonSchema.properties[fieldId];
                    }
                    else if (jsonSchema.properties[fieldId].type === 'object') {
                        SchemaPreprocessor.removeRecursiveRefProperties(jsonSchema.properties[fieldId], definitionPath);
                    }
                }
            }
        }
    };
    /**
     * Enables alias names for JSON schema extensions.
     *
     * Copies the value of each alias JSON schema property
     * to the JSON schema property of ngx-schema-form.
     *
     * @param schema JSON schema to enable alias names.
     */
    /**
     * Enables alias names for JSON schema extensions.
     *
     * Copies the value of each alias JSON schema property
     * to the JSON schema property of ngx-schema-form.
     *
     * @private
     * @param {?} schema JSON schema to enable alias names.
     * @return {?}
     */
    SchemaPreprocessor.normalizeExtensions = /**
     * Enables alias names for JSON schema extensions.
     *
     * Copies the value of each alias JSON schema property
     * to the JSON schema property of ngx-schema-form.
     *
     * @private
     * @param {?} schema JSON schema to enable alias names.
     * @return {?}
     */
    function (schema) {
        /** @type {?} */
        var extensions = [
            { name: "fieldsets", regex: /^x-?field-?sets$/i },
            { name: "widget", regex: /^x-?widget$/i },
            { name: "visibleIf", regex: /^x-?visible-?if$/i }
        ];
        /** @type {?} */
        var keys = Object.keys(schema);
        var _loop_1 = function (i) {
            /** @type {?} */
            var k = keys[i];
            /** @type {?} */
            var e = extensions.find((/**
             * @param {?} e
             * @return {?}
             */
            function (e) { return !!k.match(e.regex); }));
            if (e) {
                /** @type {?} */
                var v = schema[k];
                /** @type {?} */
                var copy = JSON.parse(JSON.stringify(v));
                schema[e.name] = copy;
            }
        };
        for (var i = 0; i < keys.length; ++i) {
            _loop_1(i);
        }
    };
    return SchemaPreprocessor;
}());
export { SchemaPreprocessor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1hcHJlcHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjaGVtYS1mb3JtLyIsInNvdXJjZXMiOlsibGliL21vZGVsL3NjaGVtYXByZXByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxTQUFTLENBQUM7Ozs7OztBQUVoQyxTQUFTLGFBQWEsQ0FBQyxPQUFPLEVBQUUsSUFBSTtJQUNsQyxPQUFPLHNCQUFvQixJQUFJLFVBQUssT0FBUyxDQUFDO0FBQ2hELENBQUM7Ozs7OztBQUVELFNBQVMsV0FBVyxDQUFDLE9BQU8sRUFBRSxJQUFJOztRQUM1QixJQUFJLEdBQUcsYUFBYSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM7SUFDdkMsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN4QixDQUFDOzs7Ozs7QUFFRCxTQUFTLGFBQWEsQ0FBQyxPQUFPLEVBQUUsSUFBSTs7UUFDOUIsSUFBSSxHQUFHLGFBQWEsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDO0lBQ3ZDLE1BQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEIsQ0FBQztBQUVEO0lBQUE7SUFxS0EsQ0FBQzs7Ozs7O0lBbktRLDZCQUFVOzs7OztJQUFqQixVQUFrQixVQUFlLEVBQUUsSUFBVTtRQUFWLHFCQUFBLEVBQUEsVUFBVTtRQUMzQyxVQUFVLEdBQUcsVUFBVSxJQUFJLEVBQUUsQ0FBQztRQUM5QixrQkFBa0IsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNuRCxJQUFJLFVBQVUsQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFFO1lBQ2hDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDckQsa0JBQWtCLENBQUMsdUJBQXVCLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzlEO2FBQU0sSUFBSSxV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RSxjQUFjLEVBQUU7WUFDNUMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsRUFBRTtTQUNwRDs7WUFDSyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7Z0NBQ3ZCLENBQUM7O2dCQUNKLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDOztnQkFDWCxDQUFDLEdBQUcsVUFBVSxDQUFDLElBQUk7Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBbEIsQ0FBa0IsRUFBQztZQUNoRCxJQUFJLENBQUMsRUFBRTs7b0JBQ0QsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7O29CQUNiLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO2FBQ3ZCOztRQVBILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQztvQkFBM0IsQ0FBQztTQVFUO0lBQ0gsQ0FBQztJQUNILHlCQUFDO0FBQUQsQ0FBQyxBQXJLRCxJQXFLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7aXNCbGFua30gZnJvbSAnLi91dGlscyc7XG5cbmZ1bmN0aW9uIGZvcm1hdE1lc3NhZ2UobWVzc2FnZSwgcGF0aCkge1xuICByZXR1cm4gYFBhcnNpbmcgZXJyb3Igb24gJHtwYXRofTogJHttZXNzYWdlfWA7XG59XG5cbmZ1bmN0aW9uIHNjaGVtYUVycm9yKG1lc3NhZ2UsIHBhdGgpOiB2b2lkIHtcbiAgbGV0IG1lc2cgPSBmb3JtYXRNZXNzYWdlKG1lc3NhZ2UsIHBhdGgpO1xuICB0aHJvdyBuZXcgRXJyb3IobWVzZyk7XG59XG5cbmZ1bmN0aW9uIHNjaGVtYVdhcm5pbmcobWVzc2FnZSwgcGF0aCk6IHZvaWQge1xuICBsZXQgbWVzZyA9IGZvcm1hdE1lc3NhZ2UobWVzc2FnZSwgcGF0aCk7XG4gIHRocm93IG5ldyBFcnJvcihtZXNnKTtcbn1cblxuZXhwb3J0IGNsYXNzIFNjaGVtYVByZXByb2Nlc3NvciB7XG5cbiAgc3RhdGljIHByZXByb2Nlc3MoanNvblNjaGVtYTogYW55LCBwYXRoID0gJy8nKTogYW55IHtcbiAgICBqc29uU2NoZW1hID0ganNvblNjaGVtYSB8fCB7fTtcbiAgICBTY2hlbWFQcmVwcm9jZXNzb3Iubm9ybWFsaXplRXh0ZW5zaW9ucyhqc29uU2NoZW1hKTtcbiAgICBpZiAoanNvblNjaGVtYS50eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLmNoZWNrUHJvcGVydGllcyhqc29uU2NoZW1hLCBwYXRoKTtcbiAgICAgIFNjaGVtYVByZXByb2Nlc3Nvci5jaGVja0FuZENyZWF0ZUZpZWxkc2V0cyhqc29uU2NoZW1hLCBwYXRoKTtcbiAgICB9IGVsc2UgaWYgKGpzb25TY2hlbWEudHlwZSA9PT0gJ2FycmF5Jykge1xuICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLmNoZWNrSXRlbXMoanNvblNjaGVtYSwgcGF0aCk7XG4gICAgfVxuICAgIFNjaGVtYVByZXByb2Nlc3Nvci5ub3JtYWxpemVXaWRnZXQoanNvblNjaGVtYSk7XG4gICAgU2NoZW1hUHJlcHJvY2Vzc29yLnJlY3Vyc2l2ZUNoZWNrKGpzb25TY2hlbWEsIHBhdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY2hlY2tQcm9wZXJ0aWVzKGpzb25TY2hlbWEsIHBhdGg6IHN0cmluZykge1xuICAgIGlmIChpc0JsYW5rKGpzb25TY2hlbWEucHJvcGVydGllcykpIHtcbiAgICAgIGpzb25TY2hlbWEucHJvcGVydGllcyA9IHt9O1xuICAgICAgc2NoZW1hV2FybmluZygnUHJvdmlkZWQganNvbiBzY2hlbWEgZG9lcyBub3QgY29udGFpbiBhIFxcJ3Byb3BlcnRpZXNcXCcgZW50cnkuIE91dHB1dCBzY2hlbWEgd2lsbCBiZSBlbXB0eScsIHBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGNoZWNrQW5kQ3JlYXRlRmllbGRzZXRzKGpzb25TY2hlbWE6IGFueSwgcGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKGpzb25TY2hlbWEuZmllbGRzZXRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChqc29uU2NoZW1hLm9yZGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLnJlcGxhY2VPcmRlckJ5RmllbGRzZXRzKGpzb25TY2hlbWEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLmNyZWF0ZUZpZWxkc2V0cyhqc29uU2NoZW1hKTtcbiAgICAgIH1cbiAgICB9XG4gICAgU2NoZW1hUHJlcHJvY2Vzc29yLmNoZWNrRmllbGRzVXNhZ2UoanNvblNjaGVtYSwgcGF0aCk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBjaGVja0ZpZWxkc1VzYWdlKGpzb25TY2hlbWEsIHBhdGg6IHN0cmluZykge1xuICAgIGxldCBmaWVsZHNJZDogc3RyaW5nW10gPSBPYmplY3Qua2V5cyhqc29uU2NoZW1hLnByb3BlcnRpZXMpO1xuICAgIGxldCB1c2VkRmllbGRzID0ge307XG4gICAgZm9yIChsZXQgZmllbGRzZXQgb2YganNvblNjaGVtYS5maWVsZHNldHMpIHtcbiAgICAgIGZvciAobGV0IGZpZWxkSWQgb2YgZmllbGRzZXQuZmllbGRzKSB7XG4gICAgICAgIGlmICh1c2VkRmllbGRzW2ZpZWxkSWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB1c2VkRmllbGRzW2ZpZWxkSWRdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdXNlZEZpZWxkc1tmaWVsZElkXS5wdXNoKGZpZWxkc2V0LmlkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGZpZWxkSWQgb2YgZmllbGRzSWQpIHtcbiAgICAgIGNvbnN0IGlzUmVxdWlyZWQgPSBqc29uU2NoZW1hLnJlcXVpcmVkICYmIGpzb25TY2hlbWEucmVxdWlyZWQuaW5kZXhPZihmaWVsZElkKSA+IC0xO1xuICAgICAgaWYgKGlzUmVxdWlyZWQgJiYganNvblNjaGVtYS5wcm9wZXJ0aWVzW2ZpZWxkSWRdKSB7XG4gICAgICAgIGpzb25TY2hlbWEucHJvcGVydGllc1tmaWVsZElkXS5pc1JlcXVpcmVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh1c2VkRmllbGRzLmhhc093blByb3BlcnR5KGZpZWxkSWQpKSB7XG4gICAgICAgIGlmICh1c2VkRmllbGRzW2ZpZWxkSWRdLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBzY2hlbWFFcnJvcihgJHtmaWVsZElkfSBpcyByZWZlcmVuY2VkIGJ5IG1vcmUgdGhhbiBvbmUgZmllbGRzZXQ6ICR7dXNlZEZpZWxkc1tmaWVsZElkXX1gLCBwYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgdXNlZEZpZWxkc1tmaWVsZElkXTtcbiAgICAgIH0gZWxzZSBpZiAoaXNSZXF1aXJlZCkge1xuICAgICAgICBzY2hlbWFFcnJvcihgJHtmaWVsZElkfSBpcyBhIHJlcXVpcmVkIGZpZWxkIGJ1dCBpdCBpcyBub3QgcmVmZXJlbmNlZCBhcyBwYXJ0IG9mIGEgJ29yZGVyJyBvciBhICdmaWVsZHNldCcgcHJvcGVydHlgLCBwYXRoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBqc29uU2NoZW1hW2ZpZWxkSWRdO1xuICAgICAgICBzY2hlbWFXYXJuaW5nKGBSZW1vdmluZyB1bnJlZmVyZW5jZWQgZmllbGQgJHtmaWVsZElkfWAsIHBhdGgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAobGV0IHJlbWFpbmluZ2ZpZWxkc0lkIGluIHVzZWRGaWVsZHMpIHtcbiAgICAgIGlmICh1c2VkRmllbGRzLmhhc093blByb3BlcnR5KHJlbWFpbmluZ2ZpZWxkc0lkKSkge1xuICAgICAgICBzY2hlbWFXYXJuaW5nKGBSZWZlcmVuY2luZyBub24tZXhpc3RlbnQgZmllbGQgJHtyZW1haW5pbmdmaWVsZHNJZH0gaW4gb25lIG9yIG1vcmUgZmllbGRzZXRzYCwgcGF0aCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY3JlYXRlRmllbGRzZXRzKGpzb25TY2hlbWEpIHtcbiAgICBqc29uU2NoZW1hLm9yZGVyID0gT2JqZWN0LmtleXMoanNvblNjaGVtYS5wcm9wZXJ0aWVzKTtcbiAgICBTY2hlbWFQcmVwcm9jZXNzb3IucmVwbGFjZU9yZGVyQnlGaWVsZHNldHMoanNvblNjaGVtYSk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyByZXBsYWNlT3JkZXJCeUZpZWxkc2V0cyhqc29uU2NoZW1hKSB7XG4gICAganNvblNjaGVtYS5maWVsZHNldHMgPSBbe1xuICAgICAgaWQ6ICdmaWVsZHNldC1kZWZhdWx0JyxcbiAgICAgIHRpdGxlOiBqc29uU2NoZW1hLnRpdGxlIHx8ICcnLFxuICAgICAgZGVzY3JpcHRpb246IGpzb25TY2hlbWEuZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICBuYW1lOiBqc29uU2NoZW1hLm5hbWUgfHwgJycsXG4gICAgICBmaWVsZHM6IGpzb25TY2hlbWEub3JkZXJcbiAgICB9XTtcbiAgICBkZWxldGUganNvblNjaGVtYS5vcmRlcjtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIG5vcm1hbGl6ZVdpZGdldChmaWVsZFNjaGVtYTogYW55KSB7XG4gICAgbGV0IHdpZGdldCA9IGZpZWxkU2NoZW1hLndpZGdldDtcbiAgICBpZiAod2lkZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHdpZGdldCA9IHsnaWQnOiBmaWVsZFNjaGVtYS50eXBlfTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aWRnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICB3aWRnZXQgPSB7J2lkJzogd2lkZ2V0fTtcbiAgICB9XG4gICAgZmllbGRTY2hlbWEud2lkZ2V0ID0gd2lkZ2V0O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY2hlY2tJdGVtcyhqc29uU2NoZW1hLCBwYXRoKSB7XG4gICAgaWYgKGpzb25TY2hlbWEuaXRlbXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgc2NoZW1hRXJyb3IoJ05vIFxcJ2l0ZW1zXFwnIHByb3BlcnR5IGluIGFycmF5JywgcGF0aCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVjdXJzaXZlQ2hlY2soanNvblNjaGVtYSwgcGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKGpzb25TY2hlbWEudHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGZvciAobGV0IGZpZWxkSWQgaW4ganNvblNjaGVtYS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmIChqc29uU2NoZW1hLnByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoZmllbGRJZCkpIHtcbiAgICAgICAgICBsZXQgZmllbGRTY2hlbWEgPSBqc29uU2NoZW1hLnByb3BlcnRpZXNbZmllbGRJZF07XG4gICAgICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoZmllbGRTY2hlbWEsIHBhdGggKyBmaWVsZElkICsgJy8nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGpzb25TY2hlbWEuaGFzT3duUHJvcGVydHkoJ2RlZmluaXRpb25zJykpIHtcbiAgICAgICAgZm9yIChsZXQgZmllbGRJZCBpbiBqc29uU2NoZW1hLmRlZmluaXRpb25zKSB7XG4gICAgICAgICAgaWYgKGpzb25TY2hlbWEuZGVmaW5pdGlvbnMuaGFzT3duUHJvcGVydHkoZmllbGRJZCkpIHtcbiAgICAgICAgICAgIGxldCBmaWVsZFNjaGVtYSA9IGpzb25TY2hlbWEuZGVmaW5pdGlvbnNbZmllbGRJZF07XG4gICAgICAgICAgICBTY2hlbWFQcmVwcm9jZXNzb3IucmVtb3ZlUmVjdXJzaXZlUmVmUHJvcGVydGllcyhmaWVsZFNjaGVtYSwgYCMvZGVmaW5pdGlvbnMvJHtmaWVsZElkfWApO1xuICAgICAgICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoZmllbGRTY2hlbWEsIHBhdGggKyBmaWVsZElkICsgJy8nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGpzb25TY2hlbWEudHlwZSA9PT0gJ2FycmF5Jykge1xuICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoanNvblNjaGVtYS5pdGVtcywgcGF0aCArICcqLycpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHJlbW92ZVJlY3Vyc2l2ZVJlZlByb3BlcnRpZXMoanNvblNjaGVtYSwgZGVmaW5pdGlvblBhdGgpIHtcbiAgICAvLyB0byBhdm9pZCBpbmZpbml0ZSBsb29wXG4gICAgaWYgKGpzb25TY2hlbWEudHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGZvciAobGV0IGZpZWxkSWQgaW4ganNvblNjaGVtYS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmIChqc29uU2NoZW1hLnByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoZmllbGRJZCkpIHtcbiAgICAgICAgICBpZiAoanNvblNjaGVtYS5wcm9wZXJ0aWVzW2ZpZWxkSWRdLiRyZWZcbiAgICAgICAgICAgICYmIGpzb25TY2hlbWEucHJvcGVydGllc1tmaWVsZElkXS4kcmVmID09PSBkZWZpbml0aW9uUGF0aCkge1xuICAgICAgICAgICAgZGVsZXRlIGpzb25TY2hlbWEucHJvcGVydGllc1tmaWVsZElkXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGpzb25TY2hlbWEucHJvcGVydGllc1tmaWVsZElkXS50eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgU2NoZW1hUHJlcHJvY2Vzc29yLnJlbW92ZVJlY3Vyc2l2ZVJlZlByb3BlcnRpZXMoanNvblNjaGVtYS5wcm9wZXJ0aWVzW2ZpZWxkSWRdLCBkZWZpbml0aW9uUGF0aCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogRW5hYmxlcyBhbGlhcyBuYW1lcyBmb3IgSlNPTiBzY2hlbWEgZXh0ZW5zaW9ucy5cbiAgICpcbiAgICogQ29waWVzIHRoZSB2YWx1ZSBvZiBlYWNoIGFsaWFzIEpTT04gc2NoZW1hIHByb3BlcnR5XG4gICAqIHRvIHRoZSBKU09OIHNjaGVtYSBwcm9wZXJ0eSBvZiBuZ3gtc2NoZW1hLWZvcm0uXG4gICAqXG4gICAqIEBwYXJhbSBzY2hlbWEgSlNPTiBzY2hlbWEgdG8gZW5hYmxlIGFsaWFzIG5hbWVzLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgbm9ybWFsaXplRXh0ZW5zaW9ucyhzY2hlbWE6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGV4dGVuc2lvbnMgPSBbXG4gICAgICAgIHsgbmFtZTogXCJmaWVsZHNldHNcIiwgcmVnZXg6IC9eeC0/ZmllbGQtP3NldHMkL2kgfSxcbiAgICAgICAgeyBuYW1lOiBcIndpZGdldFwiLCAgICByZWdleDogL154LT93aWRnZXQkL2kgfSxcbiAgICAgICAgeyBuYW1lOiBcInZpc2libGVJZlwiLCByZWdleDogL154LT92aXNpYmxlLT9pZiQvaSB9XG4gICAgXTtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc2NoZW1hKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBrID0ga2V5c1tpXTtcbiAgICAgIGxldCBlID0gZXh0ZW5zaW9ucy5maW5kKGUgPT4gISFrLm1hdGNoKGUucmVnZXgpKTtcbiAgICAgIGlmIChlKSB7XG4gICAgICAgIGxldCB2ID0gc2NoZW1hW2tdO1xuICAgICAgICBsZXQgY29weSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodikpO1xuICAgICAgICBzY2hlbWFbZS5uYW1lXSA9IGNvcHk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbiJdfQ==