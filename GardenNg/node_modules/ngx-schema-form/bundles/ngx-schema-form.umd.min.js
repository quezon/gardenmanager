!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("z-schema"),require("jexl"),require("@angular/forms"),require("@angular/common"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("ngx-schema-form",["exports","rxjs/operators","z-schema","jexl","@angular/forms","@angular/common","@angular/core","rxjs"],e):e(t["ngx-schema-form"]={},t.rxjs.operators,t.ZSchema,t.JEXL,t.ng.forms,t.ng.common,t.ng.core,t.rxjs)}(this,function(t,u,e,r,i,n,a,d){"use strict";var o=(s.prototype.clear=function(){this.actions={}},s.prototype.register=function(t,e){this.actions[t]=e},s.prototype.get=function(t){return this.actions[t]},s);function s(){this.actions={}}var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function c(t,e){function r(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function x(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return a}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}var v=(Object.defineProperty(f.prototype,"_canonicalPath",{get:function(){return this.__canonicalPath},set:function(t){this.__canonicalPath=t,this.__canonicalPathNotation=(this.__canonicalPath||"").replace(new RegExp("^/","ig"),"").replace(new RegExp("/$","ig"),"").replace(new RegExp("/","ig"),".")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"canonicalPathNotation",{get:function(){return this.__canonicalPathNotation},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rootName",{get:function(){return this._rootName},enumerable:!0,configurable:!0}),f.prototype.createRootName=function(){return this.schema&&this.schema.name?this._rootName=this.schema.name.replace(new RegExp("[\\s]+","ig"),"_"):""},Object.defineProperty(f.prototype,"valueChanges",{get:function(){return this._valueChanges},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"errorsChanges",{get:function(){return this._errorsChanges},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"type",{get:function(){return this.schema.type},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"root",{get:function(){return this._root||this},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"valid",{get:function(){return null===this._errors},enumerable:!0,configurable:!0}),f.prototype.updateValueAndValidity=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._updateValue(),e&&this.valueChanges.next(this.value),this._runValidation(),this.parent&&!t&&this.parent.updateValueAndValidity(t,e)},f.prototype._runValidation=function(){var t=this.schemaValidator(this._value)||[],e=this.validatorRegistry.get(this.path);if(e){var r=e(this.value,this,this.findRoot());t=this.mergeErrors(t,r)}0===t.length&&(t=null),this._errors=t,this.setErrors(this._errors)},f.prototype.mergeErrors=function(t,e){return e&&(Array.isArray(e)?t=t.concat.apply(t,h(e)):t.push(e)),t},f.prototype.setErrors=function(t){this._errors=t,this._errorsChanges.next(t)},f.prototype.extendErrors=function(t){t=this.mergeErrors(this._errors||[],t),this.setErrors(t)},f.prototype.searchProperty=function(t){var e=this,r=null,n=null;if("/"===t[0])n=(r=this.findRoot()).getProperty(t.substr(1));else for(;null===n&&null!==e.parent;)e=r=e.parent,n=r.getProperty(t);return n},f.prototype.findRoot=function(){for(var t=this;null!==t.parent;)t=t.parent;return t},f.prototype.setVisible=function(t){this._visible=t,this._visibilityChanges.next(t),this.updateValueAndValidity(),this.parent&&this.parent.updateValueAndValidity(!1,!0)},f.prototype.__evaluateVisibilityIf=function(t,e,r,n,i){var o,a;void 0===n&&(n=""),void 0===i&&(i="");try{var s=!1;if(-1!==i.indexOf("$ANY$"))s=n&&0<n.length;else if(0===(i||[]).toString().indexOf("$EXP$")){var l=Array.isArray(i)?i:i?[i]:[];try{for(var c=x(l),p=c.next();!p.done;p=c.next()){var h=p.value.substring("$EXP$".length);if(s=!0===this.expressionCompilerVisibiltyIf.evaluate(h,{source:t,target:e}))break}}catch(u){o={error:u}}finally{try{p&&!p.done&&(a=c["return"])&&a.call(c)}finally{if(o)throw o.error}}}else s=-1!==i.indexOf(n);return s}catch(d){console.error('Error processing "VisibileIf" expression for path: ',r,"source - "+t._canonicalPath+": ",t,"target - "+e._canonicalPath+": ",e,"value:",n,"expression: ",i,"error: ",d)}},f.prototype.__bindVisibility=function(){var t,e,m=this,r=this.schema.visibleIf,n=(r||{}).oneOf||(r||{}).allOf;if(n){var i=function(s){if("object"==typeof s&&0===Object.keys(s).length)c.setVisible(!1);else if(s!==undefined){var l=[],t=function(y){var t,e;if(s.hasOwnProperty(y)){var r=c.findProperties(c,y);if((r||[]).length){var n=function(e){if(e){var t=void 0;c.schema.visibleIf.oneOf?t=e.valueChanges.pipe(u.map(function(t){return m.__evaluateVisibilityIf(m,e,y,t,s[y])})):c.schema.visibleIf.allOf&&(t=e.valueChanges.pipe(u.map(function(t){var e,r,n,i;try{for(var o=x(m.schema.visibleIf.allOf),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var l=x(Object.keys(s)),c=l.next();!c.done;c=l.next()){var p=c.value,h=m.searchProperty(p),u=h.value;if(!m.__evaluateVisibilityIf(m,h,y,u,s[p]))return!1}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=l["return"])&&i.call(l)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}return!0})));var r=e._visibilityChanges,n=d.combineLatest([t,r],function(t,e){return t&&e});l.push(n)}};try{for(var i=x(r),o=i.next();!o.done;o=i.next())n(o.value)}catch(a){t={error:a}}finally{try{o&&!o.done&&(e=i["return"])&&e.call(i)}finally{if(t)throw t.error}}}else console.warn("Can't find property "+y+" for visibility check of "+c.path),c.registerMissingVisibilityBinding(y,c),c.setVisible(!1)}};for(var e in s)t(e);d.combineLatest(l,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return-1!==t.indexOf(!0)}).pipe(u.distinctUntilChanged()).subscribe(function(t){m.setVisible(t)})}},c=this;try{for(var o=x(n),a=o.next();!a.done;a=o.next())i(a.value)}catch(s){t={error:s}}finally{try{a&&!a.done&&(e=o["return"])&&e.call(o)}finally{if(t)throw t.error}}return!0}},f.prototype._bindVisibility=function(){var l=this;if(!this.__bindVisibility()){var c=this.schema.visibleIf;if("object"==typeof c&&0===Object.keys(c).length)this.setVisible(!1);else if(c!==undefined){var p=[],t=function(i){var t,e;if(c.hasOwnProperty(i)){var r=h.findProperties(h,i);if((r||[]).length){var n=function(e){if(e){var t=e.valueChanges.pipe(u.map(function(t){return l.__evaluateVisibilityIf(l,e,i,t,c[i])})),r=e._visibilityChanges,n=d.combineLatest([t,r],function(t,e){return t&&e});p.push(n)}};try{for(var o=x(r),a=o.next();!a.done;a=o.next())n(a.value)}catch(s){t={error:s}}finally{try{a&&!a.done&&(e=o["return"])&&e.call(o)}finally{if(t)throw t.error}}}else console.warn("Can't find property "+i+" for visibility check of "+h.path),h.registerMissingVisibilityBinding(i,h),h.setVisible(!1)}},h=this;for(var e in c)t(e);d.combineLatest(p,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return-1!==t.indexOf(!0)}).pipe(u.distinctUntilChanged()).subscribe(function(t){l.setVisible(t)})}}},f.prototype.registerMissingVisibilityBinding=function(t,e){e._propertyBindingRegistry.getPropertyBindingsVisibility().add(t,e.path)},f.prototype.findProperties=function(t,e){var r,n,i=[],o=this.findPropertyPaths(t,e);try{for(var a=x(o),s=a.next();!s.done;s=a.next()){var l=s.value,c=t.searchProperty(l);c&&i.push(c)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(n=a["return"])&&n.call(a)}finally{if(r)throw r.error}}return i},f.prototype.findPropertyPaths=function(t,e,r){var n=e.indexOf("*");if(-1===n)return[e];var i=-1<n?e.substring(0,n-1):e,o=-1<n?e.substring(n+1):e,a=t.searchProperty(i),s=[];if(a instanceof m)for(var l=a.properties,c=0;c<l.length;c++){var p=(r||"")+i+(i.endsWith("/")?"":"/")+c+o,h=(r||"")+i+c;-1===p.indexOf("*")&&s.push(p);var u=this.findPropertyPaths(l[c],o,h);s=s.concat(u)}return s},f);function f(t,e,r,n,i,o){this.validatorRegistry=e,this.schema=n,this._value=null,this._errors=null,this._valueChanges=new d.BehaviorSubject(null),this._errorsChanges=new d.BehaviorSubject(null),this._visible=!0,this._visibilityChanges=new d.BehaviorSubject(!0),this.schemaValidator=t.createValidatorFn(this.schema),this.expressionCompilerVisibiltyIf=r.createExpressionCompilerVisibilityIf(),(this._parent=i)?this._root=i.root:this instanceof m&&((this._root=this)._rootName=this.createRootName()),this._path=o}var y,m=(c(g,y=v),Object.defineProperty(g.prototype,"properties",{get:function(){return this._properties},set:function(t){this._properties=new Proxy(t,this._propertyProxyHandler)},enumerable:!0,configurable:!0}),g.prototype.getProperty=function(t){var e=t.indexOf("/"),r=-1!==e?t.substr(0,e):t,n=this.properties[r];if(null!==n&&-1!==e&&n instanceof g){var i=t.substr(e+1);n=n.getProperty(i)}return n},g.prototype.forEachChild=function(t){for(var e in this.properties)this.properties.hasOwnProperty(e)&&t(this.properties[e],e)},g.prototype.forEachChildRecursive=function(e){this.forEachChild(function(t){e(t),t instanceof g&&t.forEachChildRecursive(e)})},g.prototype._bindVisibility=function(){y.prototype._bindVisibility.call(this),this._bindVisibilityRecursive()},g.prototype._bindVisibilityRecursive=function(){this.forEachChildRecursive(function(t){t._bindVisibility()})},g.prototype.isRoot=function(){return this===this.root},g);function g(){var t=null!==y&&y.apply(this,arguments)||this;return t._properties=null,t._propertyProxyHandler={set:function(p,h,t,e){var r=function(t){var e,r,n=t;if(Array.isArray(p)&&t instanceof v){n&&(n._canonicalPath=function(t,e){var r;if(t&&-1!==(r=t.lastIndexOf("*")))return t.substring(0,r)+e.toString()+t.substring(r+1)}(n._canonicalPath,h))}var i=n,o=Array.isArray(i.properties)?i.properties:Object.values(i.properties||{});if((n.path||"").endsWith("/*"))try{for(var a=x(o),s=a.next();!s.done;s=a.next()){var l=s.value;l._canonicalPath=n._canonicalPath+l._canonicalPath.substring(n.path.length)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}return{property:n,children:o}}(t),m=r.property,g=r.children,n=p[h]=t;return function(){function t(t){var e,r,n=t._propertyBindingRegistry.getPropertyBindingsVisibility(),i=[];t._canonicalPath&&(i=i.concat(i.concat(n.findByDependencyPath(t._canonicalPath)||[])),t._canonicalPath.startsWith("/")&&(i=i.concat(i.concat(n.findByDependencyPath(t._canonicalPath.substring(1))||[])))),i=i.concat(n.findByDependencyPath(t.path)||[]),t.path.startsWith("/")&&(i=i.concat(i.concat(n.findByDependencyPath(t.path.substring(1))||[])));var o={};try{for(var a=x(i),s=a.next();!s.done;s=a.next()){var l=s.value;o[l]=l}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}return Object.keys(o)}var e,r,n,i,o=[m].concat(g);try{for(var a=x(o),s=a.next();!s.done;s=a.next()){var l=s.value;if(l instanceof v)try{var c=t(l);try{for(var p=x(c),h=p.next();!h.done;h=p.next()){var u=h.value;l.searchProperty(u)._bindVisibility()}}catch(d){n={error:d}}finally{try{h&&!h.done&&(i=p["return"])&&i.call(p)}finally{if(n)throw n.error}}}catch(f){console.error("Rebinding visibility error at path:",l.path,"property:",l,f)}}}catch(y){e={error:y}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}}(),n},get:function(t,e,r){return t[e]},deleteProperty:function(t,e){return delete t[e]}},t}var b={},P=(w.prototype.createProperty=function(t,e,r){void 0===e&&(e=null);var n=null,i="",o="";if(e){if(i+=e.path,null!==e.parent&&(i+="/",o+="/"),"object"===e.type)i+=r,o+=r;else{if("array"!==e.type)throw"Instanciation of a FormProperty with an unknown parent type: "+e.type;i+="*",o+="*"}o=(e._canonicalPath||e.path)+o}else o=i="/";if(t.$ref){var a=this.schemaValidatorFactory.getSchema(e.root.schema,t.$ref);n=this.createProperty(a,e,i)}else{if(!b[t.type])throw new TypeError("Undefined type "+t.type+" (existing: "+Object.keys(b)+")");n="object"===t.type||"array"===t.type?b[t.type](this.schemaValidatorFactory,this.validatorRegistry,this.expressionCompilerFactory,t,e,i,this):b[t.type](this.schemaValidatorFactory,this.validatorRegistry,this.expressionCompilerFactory,t,e,i)}return n._propertyBindingRegistry=this.propertyBindingRegistry,n._canonicalPath=o,n instanceof m&&this.initializeRoot(n),n},w.prototype.initializeRoot=function(t){t.reset(null,!0),t._bindVisibility()},w);function w(t,e,r,n){this.schemaValidatorFactory=t,this.validatorRegistry=e,this.propertyBindingRegistry=r,this.expressionCompilerFactory=n}function C(t,e){return"Parsing error on "+e+": "+t}function I(t,e){var r=C(t,e);throw new Error(r)}function O(t,e){var r=C(t,e);throw new Error(r)}var _=(V.preprocess=function(t,e){void 0===e&&(e="/"),V.normalizeExtensions(t=t||{}),"object"===t.type?(V.checkProperties(t,e),V.checkAndCreateFieldsets(t,e)):"array"===t.type&&V.checkItems(t,e),V.normalizeWidget(t),V.recursiveCheck(t,e)},V.checkProperties=function(t,e){!function r(t){return null===t||t===undefined}(t.properties)||(t.properties={},O("Provided json schema does not contain a 'properties' entry. Output schema will be empty",e))},V.checkAndCreateFieldsets=function(t,e){t.fieldsets===undefined&&(t.order!==undefined?V.replaceOrderByFieldsets(t):V.createFieldsets(t)),V.checkFieldsUsage(t,e)},V.checkFieldsUsage=function(t,e){var r,n,i,o,a,s,l=Object.keys(t.properties),c={};try{for(var p=x(t.fieldsets),h=p.next();!h.done;h=p.next()){var u=h.value;try{for(var d=x(u.fields),f=d.next();!f.done;f=d.next())c[g=f.value]===undefined&&(c[g]=[]),c[g].push(u.id)}catch(P){i={error:P}}finally{try{f&&!f.done&&(o=d["return"])&&o.call(d)}finally{if(i)throw i.error}}}}catch(w){r={error:w}}finally{try{h&&!h.done&&(n=p["return"])&&n.call(p)}finally{if(r)throw r.error}}try{for(var y=x(l),m=y.next();!m.done;m=y.next()){var g=m.value,v=t.required&&-1<t.required.indexOf(g);v&&t.properties[g]&&(t.properties[g].isRequired=!0),c.hasOwnProperty(g)?(1<c[g].length&&I(g+" is referenced by more than one fieldset: "+c[g],e),delete c[g]):v?I(g+" is a required field but it is not referenced as part of a 'order' or a 'fieldset' property",e):(delete t[g],O("Removing unreferenced field "+g,e))}}catch(C){a={error:C}}finally{try{m&&!m.done&&(s=y["return"])&&s.call(y)}finally{if(a)throw a.error}}for(var b in c)c.hasOwnProperty(b)&&O("Referencing non-existent field "+b+" in one or more fieldsets",e)},V.createFieldsets=function(t){t.order=Object.keys(t.properties),V.replaceOrderByFieldsets(t)},V.replaceOrderByFieldsets=function(t){t.fieldsets=[{id:"fieldset-default",title:t.title||"",description:t.description||"",name:t.name||"",fields:t.order}],delete t.order},V.normalizeWidget=function(t){var e=t.widget;e===undefined?e={id:t.type}:"string"==typeof e&&(e={id:e}),t.widget=e},V.checkItems=function(t,e){t.items===undefined&&I("No 'items' property in array",e)},V.recursiveCheck=function(t,e){if("object"===t.type){for(var r in t.properties)if(t.properties.hasOwnProperty(r)){var n=t.properties[r];V.preprocess(n,e+r+"/")}if(t.hasOwnProperty("definitions"))for(var r in t.definitions)t.definitions.hasOwnProperty(r)&&(n=t.definitions[r],V.removeRecursiveRefProperties(n,"#/definitions/"+r),V.preprocess(n,e+r+"/"))}else"array"===t.type&&V.preprocess(t.items,e+"*/")},V.removeRecursiveRefProperties=function(t,e){if("object"===t.type)for(var r in t.properties)t.properties.hasOwnProperty(r)&&(t.properties[r].$ref&&t.properties[r].$ref===e?delete t.properties[r]:"object"===t.properties[r].type&&V.removeRecursiveRefProperties(t.properties[r],e))},V.normalizeExtensions=function(o){for(var a=[{name:"fieldsets",regex:/^x-?field-?sets$/i},{name:"widget",regex:/^x-?widget$/i},{name:"visibleIf",regex:/^x-?visible-?if$/i}],s=Object.keys(o),t=function(t){var e=s[t],r=a.find(function(t){return!!e.match(t.regex)});if(r){var n=o[e],i=JSON.parse(JSON.stringify(n));o[r.name]=i}},e=0;e<s.length;++e)t(e)},V);function V(){}var R=(E.prototype.register=function(t,e){this.validators[t]=e},E.prototype.get=function(t){return this.validators[t]},E.prototype.clear=function(){this.validators=[]},E);function E(){this.validators=[]}var F=(k.prototype.clear=function(){this.bindings=[]},k.prototype.register=function(t,e){this.bindings[t]=[].concat(e)},k.prototype.get=function(t){return this.bindings[t]},k);function k(){this.bindings=[]}var j=(A.prototype.reset=function(){},A);function A(){}var S,B=(c(D,S=j),D.prototype.createSchemaValidator=function(){this.zschema=new e({breakOnFirstError:!1})},D.prototype.reset=function(){this.createSchemaValidator()},D.prototype.createValidatorFn=function(r){var n=this;return function(t){"number"!==r.type&&"integer"!==r.type||(t=+t),n.zschema.validate(t,r);var e=n.zschema.getLastErrors();return n.denormalizeRequiredPropertyPaths(e),e||null}},D.prototype.getSchema=function(t,e){if(this.zschema.compileSchema(t))return this.getDefinition(t,e);throw this.zschema.getLastError()},D.prototype.denormalizeRequiredPropertyPaths=function(t){t&&t.length&&(t=t.map(function(t){return"#/"===t.path&&"OBJECT_MISSING_REQUIRED_PROPERTY"===t.code&&(t.path=""+t.path+t.params[0]),t}))},D.prototype.getDefinition=function(t,e){var r=t;return e.split("/").slice(1).forEach(function(t){t&&(r=r[t])}),r},D);function D(){var t=S.call(this)||this;return t.createSchemaValidator(),t}var W=(z.prototype.setDefaultWidget=function(t){this.defaultWidget=t},z.prototype.getDefaultWidget=function(){return this.defaultWidget},z.prototype.hasWidget=function(t){return this.widgets.hasOwnProperty(t)},z.prototype.register=function(t,e){this.widgets[t]=e},z.prototype.getWidgetType=function(t){return this.hasWidget(t)?this.widgets[t]:this.defaultWidget},z);function z(){this.widgets={}}var q=(M.prototype.createWidget=function(t,e){var r=this.registry.getWidgetType(e),n=this.resolver.resolveComponentFactory(r);return t.createComponent(n)},M.decorators=[{type:a.Injectable}],M.ctorParameters=function(){return[{type:W},{type:a.ComponentFactoryResolver}]},M);function M(t,e){this.registry=t,this.resolver=e}var N=(L.prototype.destroy=function(){this.onDestroy.next(!0)},L.decorators=[{type:a.Injectable}],L.ctorParameters=function(){return[]},L);function L(){this.onDestroy=new d.Subject}var T=($.prototype.getPropertyBindings=function(t){return this.bindings[t]=this.bindings[t]||new U,this.bindings[t]},$.prototype.getPropertyBindingsVisibility=function(){return this.getPropertyBindings(H.visibility)},$);function $(){this.bindings={}}var H={visibility:0};H[H.visibility]="visibility";var U=(J.prototype.add=function(t,e){this.sourcesIndex.store(e,t),this.dependenciesIndex.store(t,e)},J.prototype.findByDependencyPath=function(t){var e,r,n=this.dependenciesIndex.find(t);n.results=n.results||[];var i=[];try{for(var o=x(n.results),a=o.next();!a.done;a=o.next()){var s=a.value;i=i.concat(Object.keys(s.value))}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}return n.found?i:[]},J.prototype.getBySourcePropertyPath=function(t){var e,r,n=this.sourcesIndex.find(t);n.results=n.results||[];var i=[];try{for(var o=x(n.results),a=o.next();!a.done;a=o.next()){var s=a.value;i=i.concat(Object.keys(s.value))}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}return n.found?i:[]},J.prototype.createPathIndex=function(t){return t.split("/")},J);function J(){this.sourcesIndex=new K,this.dependenciesIndex=new K}var K=(X.prototype._createPathIndex=function(t){return t.replace(new RegExp("//","g"),"/").replace(new RegExp("^/","g"),"").split("/").filter(function(t){return t})},X.prototype.store=function(t,e){this._storeIndex(this._createPathIndex(t),e)},X.prototype._storeIndex=function(t,e){var r,n,i=this.index;try{for(var o=x(t),a=o.next();!a.done;a=o.next()){var s=a.value;i[s]=i[s]||{},i=i[s]}}catch(l){r={error:l}}finally{try{a&&!a.done&&(n=o["return"])&&n.call(o)}finally{if(r)throw r.error}}i&&e&&(i[X.MARKER]=i[X.MARKER]||{},i[X.MARKER][e]=e)},X.prototype.find=function(t){return this._findInIndex(this._createPathIndex(t))},X.prototype._findInIndex=function(t){var e={target:t,found:!1,results:[]};return this.__findIndex(e,t,this.index,[]),e},X.prototype.__findIndex=function(t,e,r,n){var i,o,a=n||[],s=e[0],l="*"===s?Object.keys(r):[],c=(Array.isArray(s)?s:[s]).concat(l),p=c.filter(function(t,e){return"*"!==t&&c.indexOf(t)===e});r["*"]&&p.push("*");var h=[];try{for(var u=x(p),d=u.next();!d.done;d=u.next()){var f=d.value,y=e.slice(1),m=r[f],g=a.concat(f);if(1===e.length&&(!this.findOnlyWithValue||m&&m[X.MARKER])&&(t.results=t.results||[],t.results.push({path:g,value:m[X.MARKER]}),h.push(g),t.found=0<t.results.length),!y||!y.length||!m)break;var v=this.__findIndex(t,y,m,g);h=h.concat(v)}}catch(b){i={error:b}}finally{try{d&&!d.done&&(o=u["return"])&&o.call(u)}finally{if(i)throw i.error}}return h},X.MARKER="$____value",X);function X(){this.index={},this.findOnlyWithValue=!0}function G(){}var Y,Z=(c(Q,Y=G),Q.prototype.createExpressionCompiler=function(){return new tt},Q.prototype.createExpressionCompilerVisibilityIf=function(){return new rt},Q);function Q(){return null!==Y&&Y.apply(this,arguments)||this}var tt=(et.prototype.evaluate=function(t,e){return void 0===e&&(e={}),(new r.Jexl).evalSync(t,e)},et);function et(){}var rt=(nt.prototype.evaluate=function(t,e){return void 0===e&&(e={source:{},target:{}}),(new r.Jexl).evalSync(t,e)},nt);function nt(){}function it(t,e,r,n){return new P(t,e,r,n)}var ot=(at.prototype.writeValue=function(t){this.rootProperty&&this.rootProperty.reset(t,!1)},at.prototype.registerOnChange=function(t){this.onChangeCallback=t,this.rootProperty&&this.rootProperty.valueChanges.subscribe(this.onValueChanges.bind(this))},at.prototype.registerOnTouched=function(t){},at.prototype.ngOnChanges=function(t){var e=this;t.validators&&this.setValidators(),t.actions&&this.setActions(),t.bindings&&this.setBindings(),this.schema&&!this.schema.type&&(this.schema.type="object"),this.schema&&t.schema&&(t.schema.firstChange||this.terminator.destroy(),_.preprocess(this.schema),this.rootProperty=this.formPropertyFactory.createProperty(this.schema),this.model,this.rootProperty.valueChanges.subscribe(this.onValueChanges.bind(this)),this.rootProperty.errorsChanges.subscribe(function(t){e.onErrorChange.emit({value:t}),e.isValid.emit(!(t&&t.length))})),this.schema&&(t.model||t.schema)&&(this.rootProperty.reset(this.model,!1),this.cdr.detectChanges())},at.prototype.setValidators=function(){if(this.validatorRegistry.clear(),this.validators)for(var t in this.validators)this.validators.hasOwnProperty(t)&&this.validatorRegistry.register(t,this.validators[t])},at.prototype.setActions=function(){if(this.actionRegistry.clear(),this.actions)for(var t in this.actions)this.actions.hasOwnProperty(t)&&this.actionRegistry.register(t,this.actions[t])},at.prototype.setBindings=function(){if(this.bindingRegistry.clear(),this.bindings)for(var t in this.bindings)this.bindings.hasOwnProperty(t)&&this.bindingRegistry.register(t,this.bindings[t])},at.prototype.reset=function(){this.rootProperty.reset(null,!0)},at.prototype.setModel=function(t){this.model?Object.assign(this.model,t):this.model=t},at.prototype.onValueChanges=function(t){this.onChangeCallback&&(this.setModel(t),this.onChangeCallback(t)),0<this.modelChange.observers.length&&(this.onChangeCallback||this.setModel(t)),this.onChange.emit({value:t})},at.decorators=[{type:a.Component,args:[{selector:"sf-form",template:'\n    <form *ngIf="rootProperty" [attr.name]="rootProperty.rootName" [attr.id]="rootProperty.rootName">\n      <sf-form-element [formProperty]="rootProperty"></sf-form-element>\n    </form>',providers:[o,R,T,F,_,q,{provide:P,useFactory:it,deps:[j,R,T,G]},N,{provide:i.NG_VALUE_ACCESSOR,useExisting:at,multi:!0}]}]}],at.ctorParameters=function(){return[{type:P},{type:o},{type:R},{type:F},{type:a.ChangeDetectorRef},{type:N}]},at.propDecorators={schema:[{type:a.Input}],model:[{type:a.Input}],actions:[{type:a.Input}],validators:[{type:a.Input}],bindings:[{type:a.Input}],onChange:[{type:a.Output}],modelChange:[{type:a.Output}],isValid:[{type:a.Output}],onErrorChange:[{type:a.Output}],onErrorsChange:[{type:a.Output}]},at);function at(t,e,r,n,i,o){this.formPropertyFactory=t,this.actionRegistry=e,this.validatorRegistry=r,this.bindingRegistry=n,this.cdr=i,this.terminator=o,this.schema=null,this.actions={},this.validators={},this.bindings={},this.onChange=new a.EventEmitter,this.modelChange=new a.EventEmitter,this.isValid=new a.EventEmitter,this.onErrorChange=new a.EventEmitter,this.onErrorsChange=new a.EventEmitter,this.rootProperty=null}var st=(lt.prototype.ngOnInit=function(){this.parseButtons(),this.setupBindings()},lt.prototype.setupBindings=function(){var r=this,t=this.bindingRegistry.get(this.formProperty.path);(t||[]).length&&t.forEach(function(t){for(var e in t)r.createBinding(e,t[e])})},lt.prototype.createBinding=function(e,r){var n=this;this.unlisten.push(this.renderer.listen(this.elementRef.nativeElement,e,function(t){r instanceof Function?r(t,n.formProperty):console.warn("Calling non function handler for eventId "+e+" for path "+n.formProperty.path)}))},lt.prototype.parseButtons=function(){var t,e;if(this.formProperty.schema.buttons!==undefined){this.buttons=this.formProperty.schema.buttons;try{for(var r=x(this.buttons),n=r.next();!n.done;n=r.next()){var i=n.value;this.createButtonCallback(i)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=r["return"])&&e.call(r)}finally{if(t)throw t.error}}}},lt.prototype.createButtonCallback=function(r){var n=this;r.action=function(t){var e;r.id&&(e=n.actionRegistry.get(r.id))&&e&&e(n.formProperty,r.parameters),t.preventDefault()}},lt.prototype.onWidgetInstanciated=function(t){this.widget=t;var e=this.formProperty.canonicalPathNotation||"field"+lt.counter++;this.formProperty.root.rootName&&(e=this.formProperty.root.rootName+":"+e),this.widget.formProperty=this.formProperty,this.widget.schema=this.formProperty.schema,this.widget.name=e,this.widget.id=e,this.widget.control=this.control},lt.prototype.ngOnDestroy=function(){this.unlisten&&this.unlisten.forEach(function(t){t()})},lt.counter=0,lt.decorators=[{type:a.Component,args:[{selector:"sf-form-element",template:'\n    <div *ngIf="formProperty.visible"\n         [class.has-error]="!control.valid"\n         [class.has-success]="control.valid">\n      <sf-widget-chooser\n        (widgetInstanciated)="onWidgetInstanciated($event)"\n        [widgetInfo]="formProperty.schema.widget">\n      </sf-widget-chooser>\n      <sf-form-element-action *ngFor="let button of buttons" [button]="button" [formProperty]="formProperty"></sf-form-element-action>\n    </div>'}]}],lt.ctorParameters=function(){return[{type:o},{type:F},{type:a.Renderer2},{type:a.ElementRef}]},lt.propDecorators={formProperty:[{type:a.Input}]},lt);function lt(t,e,r,n){this.actionRegistry=t,this.bindingRegistry=e,this.renderer=r,this.elementRef=n,this.control=new i.FormControl("",function(){return null}),this.widget=null,this.buttons=[],this.unlisten=[]}var ct=(pt.prototype.ngOnInit=function(){var e=this;this.subs=this.terminator.onDestroy.subscribe(function(t){t&&e.ref.destroy()})},pt.prototype.ngOnChanges=function(){this.ref=this.widgetFactory.createWidget(this.container,this.button.widget||"button"),this.ref.instance.button=this.button,this.ref.instance.formProperty=this.formProperty},pt.prototype.ngOnDestroy=function(){this.subs.unsubscribe()},pt.decorators=[{type:a.Component,args:[{selector:"sf-form-element-action",template:"<ng-template #target></ng-template>"}]}],pt.ctorParameters=function(){return[{type:q},{type:N}]},pt.propDecorators={button:[{type:a.Input}],formProperty:[{type:a.Input}],container:[{type:a.ViewChild,args:["target",{read:a.ViewContainerRef,"static":!0}]}]},pt);function pt(t,e){void 0===t&&(t=null),this.widgetFactory=t,this.terminator=e}var ht=(ut.prototype.ngOnInit=function(){var e=this;this.subs=this.terminator.onDestroy.subscribe(function(t){t&&e.ref.destroy()})},ut.prototype.ngOnChanges=function(){this.ref=this.widgetFactory.createWidget(this.container,this.widgetInfo.id),this.widgetInstanciated.emit(this.ref.instance),this.widgetInstance=this.ref.instance,this.cdr.detectChanges()},ut.prototype.ngOnDestroy=function(){this.subs.unsubscribe()},ut.decorators=[{type:a.Component,args:[{selector:"sf-widget-chooser",template:"<div #target></div>"}]}],ut.ctorParameters=function(){return[{type:q},{type:a.ChangeDetectorRef},{type:N}]},ut.propDecorators={widgetInfo:[{type:a.Input}],widgetInstanciated:[{type:a.Output}],container:[{type:a.ViewChild,args:["target",{read:a.ViewContainerRef,"static":!0}]}]},ut);function ut(t,e,r){void 0===t&&(t=null),this.widgetFactory=t,this.cdr=e,this.terminator=r,this.widgetInstanciated=new a.EventEmitter}var dt,ft=(c(yt,dt=v),yt.prototype.setValue=function(t,e){void 0===e&&(e=!1),this._value=t,this.updateValueAndValidity(e,!0)},yt.prototype.reset=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!0),this.resetValue(t),this.updateValueAndValidity(e,!0)},yt.prototype.resetValue=function(t){null===t&&(t=this.schema["default"]!==undefined?this.schema["default"]:this.fallbackValue()),this._value=t},yt.prototype._hasValue=function(){return this.fallbackValue()!==this.value},yt.prototype._updateValue=function(){},yt);function yt(){return null!==dt&&dt.apply(this,arguments)||this}var mt,gt=(c(vt,mt=m),vt.prototype.setValue=function(t,e){for(var r in t)t.hasOwnProperty(r)&&this.properties[r].setValue(t[r],!0);this.updateValueAndValidity(e,!0)},vt.prototype.reset=function(t,e){void 0===e&&(e=!0),t=t||this.schema["default"]||{},this.resetProperties(t),this.updateValueAndValidity(e,!0)},vt.prototype.resetProperties=function(t){for(var e in this.schema.properties)this.schema.properties.hasOwnProperty(e)&&this.properties[e].reset(t[e],!0)},vt.prototype.createProperties=function(){for(var t in this.properties={},this.propertiesId=[],this.schema.properties)if(this.schema.properties.hasOwnProperty(t)){var e=this.schema.properties[t];this.properties[t]=this.formPropertyFactory.createProperty(e,this,t),this.propertiesId.push(t)}},vt.prototype._hasValue=function(){return!!Object.keys(this.value).length},vt.prototype._updateValue=function(){this.reduceValue()},vt.prototype._runValidation=function(){var r=this;mt.prototype._runValidation.call(this),this._errors&&this._errors.forEach(function(t){var e=r.searchProperty(t.path.slice(1));e&&e.extendErrors(t)})},vt.prototype.reduceValue=function(){var r={};this.forEachChild(function(t,e){t.visible&&t._hasValue()&&(r[e]=t.value)}),this._value=r},vt);function vt(t,e,r,n,i,o,a){var s=mt.call(this,e,r,n,i,o,a)||this;return s.formPropertyFactory=t,s.propertiesId=[],s.createProperties(),s}b.object=function(t,e,r,n,i,o,a){return new gt(a,t,e,r,n,i,o)};var bt,Pt=(c(wt,bt=m),wt.prototype.addItem=function(t){void 0===t&&(t=null);var e=this.addProperty();return e.reset(t,!1),e},wt.prototype.addProperty=function(){var t=this.formPropertyFactory.createProperty(this.schema.items,this);return this.properties.push(t),t},wt.prototype.removeItem=function(e){this.properties=this.properties.filter(function(t){return t!==e}),this.updateValueAndValidity(!1,!0)},wt.prototype.setValue=function(t,e){this.createProperties(),this.resetProperties(t),this.updateValueAndValidity(e,!0)},wt.prototype._hasValue=function(){return!0},wt.prototype._updateValue=function(){this.reduceValue()},wt.prototype.reduceValue=function(){var r=[];this.forEachChild(function(t,e){t.visible&&t._hasValue()&&r.push(t.value)}),this._value=r},wt.prototype.reset=function(t,e){void 0===e&&(e=!0),t=t||this.schema["default"]||[],this.properties=[],this.resetProperties(t),this.updateValueAndValidity(e,!0)},wt.prototype.createProperties=function(){this.properties=[]},wt.prototype.resetProperties=function(t){for(var e in t)t.hasOwnProperty(e)&&this.addProperty().reset(t[e],!0)},wt);function wt(t,e,r,n,i,o,a){var s=bt.call(this,e,r,n,i,o,a)||this;return s.formPropertyFactory=t,s}b.array=function(t,e,r,n,i,o,a){return new Pt(a,t,e,r,n,i,o)};var Ct,xt=(c(It,Ct=ft),It.prototype.fallbackValue=function(){return""},It);function It(){return null!==Ct&&Ct.apply(this,arguments)||this}b.string=function(t,e,r,n,i,o){return new xt(t,e,r,n,i,o)};var Ot,_t=(c(Vt,Ot=ft),Vt.prototype.fallbackValue=function(){return null},Vt);function Vt(){return null!==Ot&&Ot.apply(this,arguments)||this}b["boolean"]=function(t,e,r,n,i,o){return new _t(t,e,r,n,i,o)};var Rt,Et=(c(Ft,Rt=ft),Ft.prototype.fallbackValue=function(){return null},Ft.prototype.setValue=function(t,e){void 0===e&&(e=!1),"string"==typeof t&&(t=t.length?-1<t.indexOf(".")?parseFloat(t):parseInt(t,10):null),this._value=t,this.updateValueAndValidity(e,!0)},Ft);function Ft(){return null!==Rt&&Rt.apply(this,arguments)||this}b.integer=function(t,e,r,n,i,o){return new Et(t,e,r,n,i,o)},b.number=function(t,e,r,n,i,o){return new Et(t,e,r,n,i,o)};function kt(){this.id="",this.name="",this.schema={}}var jt,At=(c(St,jt=kt),St.prototype.ngAfterViewInit=function(){var e=this,n=this.control;this.formProperty.valueChanges.subscribe(function(t){n.value!==t&&n.setValue(t,{emitEvent:!1})}),this.formProperty.errorsChanges.subscribe(function(t){n.setErrors(t,{emitEvent:!0});var r=(t||[]).filter(function(t){return t.path&&t.path.slice(1)===e.formProperty.path}).map(function(t){return t.message});e.errorMessages=r.filter(function(t,e){return r.indexOf(t)===e})}),n.valueChanges.subscribe(function(t){e.formProperty.setValue(t,!1)})},St);function St(){return null!==jt&&jt.apply(this,arguments)||this}var Bt,Dt=(c(Wt,Bt=kt),Wt.prototype.ngAfterViewInit=function(){var e=this.control;this.formProperty.errorsChanges.subscribe(function(t){e.setErrors(t,{emitEvent:!0})})},Wt);function Wt(){return null!==Bt&&Bt.apply(this,arguments)||this}var zt,qt=(c(Mt,zt=kt),Mt.prototype.ngAfterViewInit=function(){var e=this.control;this.formProperty.errorsChanges.subscribe(function(t){e.setErrors(t,{emitEvent:!0})})},Mt);function Mt(){return null!==zt&&zt.apply(this,arguments)||this}var Nt,Lt=(c(Tt,Nt=Dt),Tt.prototype.addItem=function(){this.formProperty.addItem(),this.updateButtonDisabledState()},Tt.prototype.removeItem=function(t){this.formProperty.removeItem(t),this.updateButtonDisabledState()},Tt.prototype.trackByIndex=function(t,e){return t},Tt.prototype.updateButtonDisabledState=function(){this.buttonDisabledAdd=this.isAddButtonDisabled(),this.buttonDisabledRemove=this.isRemoveButtonDisabled()},Tt.prototype.isAddButtonDisabled=function(){return!!(this.schema.hasOwnProperty("maxItems")&&Array.isArray(this.formProperty.properties)&&this.formProperty.properties.length>=this.schema.maxItems)},Tt.prototype.isRemoveButtonDisabled=function(){return!!(this.schema.hasOwnProperty("minItems")&&Array.isArray(this.formProperty.properties)&&this.formProperty.properties.length<=this.schema.minItems)},Tt.decorators=[{type:a.Component,args:[{selector:"sf-array-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n\t<span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n\t<div *ngFor="let itemProperty of formProperty.properties">\n\t\t<sf-form-element [formProperty]="itemProperty"></sf-form-element>\n\t\t<button (click)="removeItem(itemProperty)" class="btn btn-default array-remove-button"\n\t\t\t[disabled]="isRemoveButtonDisabled()" \n\t\t\t*ngIf="!(schema.hasOwnProperty(\'minItems\') && schema.hasOwnProperty(\'maxItems\') && schema.minItems === schema.maxItems)"\n\t\t\t>\n\t\t\t<span class="glyphicon glyphicon-minus" aria-hidden="true"></span> Remove\n\t\t</button>\n\t</div>\n\t<button (click)="addItem()" class="btn btn-default array-add-button"\n\t\t[disabled]="isAddButtonDisabled()"\n\t\t*ngIf="!(schema.hasOwnProperty(\'minItems\') && schema.hasOwnProperty(\'maxItems\') && schema.minItems === schema.maxItems)"\n\t>\n\t\t<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add\n\t</button>\n</div>'}]}],Tt);function Tt(){return null!==Nt&&Nt.apply(this,arguments)||this}var $t=(Ht.decorators=[{type:a.Component,args:[{selector:"sf-button-widget",template:'<button (click)="button.action($event)">{{button.label}}</button>'}]}],Ht);function Ht(){}var Ut,Jt=(c(Kt,Ut=qt),Kt.decorators=[{type:a.Component,args:[{selector:"sf-form-object",template:'<fieldset *ngFor="let fieldset of formProperty.schema.fieldsets">\n\t<legend *ngIf="fieldset.title">{{fieldset.title}}</legend>\n\t<div *ngIf="fieldset.description">{{fieldset.description}}</div>\n\t<div *ngFor="let fieldId of fieldset.fields">\n\t\t<sf-form-element [formProperty]="formProperty.getProperty(fieldId)"></sf-form-element>\n\t</div>\n</fieldset>'}]}],Kt);function Kt(){return null!==Ut&&Ut.apply(this,arguments)||this}var Xt,Gt=(c(Yt,Xt=At),Yt.prototype.ngAfterViewInit=function(){var e=this,r=this.control;this.formProperty.valueChanges.subscribe(function(t){r.value!==t&&(r.setValue(t,{emitEvent:!1}),t&&Array.isArray(t)&&t.map(function(t){return e.checked[t]=!0}))}),this.formProperty.errorsChanges.subscribe(function(t){r.setErrors(t,{emitEvent:!0})}),r.valueChanges.subscribe(function(t){e.formProperty.setValue(t,!1)})},Yt.prototype.onCheck=function(t){t.checked?this.checked[t.value]=!0:delete this.checked[t.value],this.formProperty.setValue(Object.keys(this.checked),!1)},Yt.decorators=[{type:a.Component,args:[{selector:"sf-checkbox-widget",template:'<div class="widget form-group">\n    <label [attr.for]="id" class="horizontal control-label">\n        {{ schema.title }}\n    </label>\n\t<div *ngIf="schema.type!=\'array\'" class="checkbox">\n\t\t<label class="horizontal control-label">\n\t\t\t<input [formControl]="control" [attr.name]="name" [attr.id]="id" [indeterminate]="control.value !== false && control.value !== true ? true :null" type="checkbox" [disabled]="schema.readOnly">\n\t\t\t<input *ngIf="schema.readOnly" [attr.name]="name" type="hidden" [formControl]="control">\n\t\t\t{{schema.description}}\n\t\t</label>\n\t</div>\n\t<ng-container *ngIf="schema.type===\'array\'">\n\t\t<div *ngFor="let option of schema.items.oneOf" class="checkbox">\n\t\t\t<label class="horizontal control-label">\n\t\t\t\t<input [attr.name]="name"\n\t\t\t\t\tvalue="{{option.enum[0]}}" type="checkbox" \n\t\t\t\t\t[attr.disabled]="schema.readOnly"\n\t\t\t\t\t(change)="onCheck($event.target)"\n\t\t\t\t\t[attr.checked]="checked[option.enum[0]] ? true : null"\n\t\t\t\t\t[attr.id]="id + \'.\' + option.enum[0]"\n\t\t\t\t\t>\n\t\t\t\t{{option.description}}\n\t\t\t</label>\n\t\t</div>\n\t</ng-container>\n</div>'}]}],Yt);function Yt(){var t=null!==Xt&&Xt.apply(this,arguments)||this;return t.checked={},t}var Zt,Qt=(c(te,Zt=At),te.prototype.ngAfterViewInit=function(){var t=this,e=this.control;this.formProperty.errorsChanges.subscribe(function(t){e.setErrors(t,{emitEvent:!0})}),this.reader.onloadend=function(){t.filedata.data=window.btoa(t.reader.result),t.formProperty.setValue(t.filedata,!1)}},te.prototype.onFileChange=function(t){var e=t.target.files[0];this.filedata.filename=e.name,this.filedata.size=e.size,this.filedata["content-type"]=e.type,this.filedata.encoding="base64",this.reader.readAsBinaryString(e)},te.decorators=[{type:a.Component,args:[{selector:"sf-file-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n  <input [name]="name" class="text-widget file-widget" [attr.id]="id"\n    [formControl]="control" type="file" [attr.disabled]="schema.readOnly?true:null"\n    (change)="onFileChange($event)">\n\t<input *ngIf="schema.readOnly" [attr.name]="name" type="hidden" [formControl]="control">\n</div>'}]}],te.ctorParameters=function(){return[]},te);function te(){var t=Zt.call(this)||this;return t.reader=new FileReader,t.filedata={},t}var ee,re=(c(ne,ee=At),ne.decorators=[{type:a.Component,args:[{selector:"sf-integer-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n  <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n\t<input [attr.readonly]="schema.readOnly?true:null" [attr.name]="name"\n\t[attr.id]="id"\n\tclass="text-widget integer-widget form-control" [formControl]="control"\n\t[attr.type]="\'number\'" [attr.min]="schema.minimum" [attr.max]="schema.maximum"\n\t[attr.placeholder]="schema.placeholder"\n\t[attr.maxLength]="schema.maxLength || null"\n  [attr.minLength]="schema.minLength || null">\n</div>'}]}],ne);function ne(){return null!==ee&&ee.apply(this,arguments)||this}var ie,oe=(c(ae,ie=At),ae.decorators=[{type:a.Component,args:[{selector:"sf-textarea-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n\t<textarea [readonly]="schema.readOnly" [name]="name"\n\t\t[attr.id]="id"\n\t\tclass="text-widget textarea-widget form-control"\n\t\t[attr.placeholder]="schema.placeholder"\n\t\t[attr.maxLength]="schema.maxLength || null"\n    [attr.minLength]="schema.minLength || null"\n\t\t[formControl]="control"></textarea>\n</div>'}]}],ae);function ae(){return null!==ie&&ie.apply(this,arguments)||this}var se,le=(c(ce,se=At),ce.decorators=[{type:a.Component,args:[{selector:"sf-radio-widget",template:'<div class="widget form-group">\n\t<label>{{schema.title}}</label>\n    <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n\t<div *ngFor="let option of schema.oneOf" class="radio">\n\t\t<label class="horizontal control-label">\n\t\t\t<input [formControl]="control" [attr.name]="name" [attr.id]="id + \'.\' + option.enum[0]" value="{{option.enum[0]}}" type="radio"  [disabled]="schema.readOnly||option.readOnly">\n\t\t\t{{option.description}}\n\t\t</label>\n\t</div>\n\t<input *ngIf="schema.readOnly" [attr.name]="name" type="hidden" [formControl]="control">\n</div>'}]}],ce);function ce(){return null!==se&&se.apply(this,arguments)||this}var pe,he=(c(ue,pe=At),ue.decorators=[{type:a.Component,args:[{selector:"sf-range-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\t\n\t<input [name]="name" class="text-widget range-widget" [attr.id]="id"\n\t[formControl]="control" [attr.type]="\'range\'" [attr.min]="schema.minimum" [attr.max]="schema.maximum" [disabled]="schema.readOnly?true:null" >\n\t<input *ngIf="schema.readOnly" [attr.name]="name" type="hidden">\n</div>'}]}],ue);function ue(){return null!==pe&&pe.apply(this,arguments)||this}var de,fe=(c(ye,de=At),ye.decorators=[{type:a.Component,args:[{selector:"sf-select-widget",template:'<div class="widget form-group">\n\t<label [attr.for]="id" class="horizontal control-label">\n\t\t{{ schema.title }}\n\t</label>\n\n\t<span *ngIf="schema.description" class="formHelp">\n\t\t{{schema.description}}\n\t</span>\n\n\t<select *ngIf="schema.type!=\'array\'" [formControl]="control" [attr.name]="name" [attr.id]="id" [disabled]="schema.readOnly" [disableControl]="schema.readOnly" class="form-control">\n\t\t<ng-container *ngIf="schema.oneOf; else use_enum">\n\t\t\t<option *ngFor="let option of schema.oneOf" [ngValue]="option.enum[0]" >{{option.description}}</option>\n\t\t</ng-container>\n\t\t<ng-template #use_enum>\n\t\t\t<option *ngFor="let option of schema.enum" [ngValue]="option" >{{option}}</option>\n\t\t</ng-template>\n\t</select>\n\n\t<select *ngIf="schema.type===\'array\'" multiple [formControl]="control" [attr.name]="name" [attr.id]="id" [disabled]="schema.readOnly" [disableControl]="schema.readOnly" class="form-control">\n    <option *ngFor="let option of schema.items.oneOf" [ngValue]="option.enum[0]" [disabled]="option.readOnly">{{option.description}}</option>\n\t</select>\n\n\t<input *ngIf="schema.readOnly" [attr.name]="name" type="hidden" [formControl]="control">\n</div>'}]}],ye);function ye(){return null!==de&&de.apply(this,arguments)||this}var me,ge=(c(ve,me=At),ve.prototype.getInputType=function(){return this.schema.widget.id&&"string"!==this.schema.widget.id?this.schema.widget.id:"text"},ve.decorators=[{type:a.Component,args:[{selector:"sf-string-widget",template:'<input *ngIf="this.schema.widget.id ===\'hidden\'; else notHiddenFieldBlock"\n  [attr.name]="name" type="hidden" [formControl]="control">\n<ng-template #notHiddenFieldBlock>\n<div class="widget form-group">\n    <label [attr.for]="id" class="horizontal control-label">\n    \t{{ schema.title }}\n    </label>\n    <span *ngIf="schema.description" class="formHelp">{{schema.description}}</span>\n    <input [name]="name" [attr.readonly]="(schema.widget.id!==\'color\') && schema.readOnly?true:null"\n    class="text-widget.id textline-widget form-control"\n    [attr.type]="!this.schema.widget.id || this.schema.widget.id === \'string\' ? \'text\' : this.schema.widget.id"\n    [attr.id]="id"  [formControl]="control" [attr.placeholder]="schema.placeholder"\n    [attr.maxLength]="schema.maxLength || null"\n    [attr.minLength]="schema.minLength || null"\n    [attr.required]="schema.isRequired || null"\n    [attr.disabled]="(schema.widget.id==\'color\' && schema.readOnly)?true:null">\n    <input *ngIf="(schema.widget.id===\'color\' && schema.readOnly)" [attr.name]="name" type="hidden" [formControl]="control">\n</div>\n</ng-template>'}]}],ve);function ve(){return null!==me&&me.apply(this,arguments)||this}var be,Pe=(c(we,be=W),we);function we(){var t=be.call(this)||this;return t.register("array",Lt),t.register("object",Jt),t.register("string",ge),t.register("search",ge),t.register("tel",ge),t.register("url",ge),t.register("email",ge),t.register("password",ge),t.register("color",ge),t.register("date",ge),t.register("date-time",ge),t.register("time",ge),t.register("integer",re),t.register("number",re),t.register("range",he),t.register("textarea",oe),t.register("file",Qt),t.register("select",fe),t.register("radio",le),t.register("boolean",Gt),t.register("checkbox",Gt),t.register("button",$t),t.setDefaultWidget(ge),t}var Ce=(Object.defineProperty(xe.prototype,"disableControl",{set:function(t){var e=t?"disable":"enable";this.ngControl.control[e]()},enumerable:!0,configurable:!0}),xe.decorators=[{type:a.Directive,args:[{selector:"[disableControl]"}]}],xe.ctorParameters=function(){return[{type:i.NgControl}]},xe.propDecorators={disableControl:[{type:a.Input}]},xe);function xe(t){this.ngControl=t}var Ie=(Oe.decorators=[{type:a.Component,args:[{selector:"sf-default-field",template:"<p>Unknow type</p>"}]}],Oe);function Oe(){}var _e=[{provide:W,useClass:Pe},{provide:j,useClass:B},{provide:G,useClass:Z}],Ve=(Re.forRoot=function(){return{ngModule:Re,providers:h(_e)}},Re.decorators=[{type:a.NgModule,args:[{imports:[n.CommonModule,i.FormsModule,i.ReactiveFormsModule],declarations:[st,ct,ot,ht,Ie,Lt,$t,Jt,Gt,Qt,re,oe,le,he,fe,ge,Ce],entryComponents:[st,ct,ot,ht,Lt,$t,Jt,Gt,Qt,re,oe,le,he,fe,ge],exports:[ot,st,ct,ht,Lt,$t,Jt,Gt,Qt,re,oe,le,he,fe,ge,Ce]}]}],Re);function Re(){}var Ee=(Fe.prototype.changed=function(){this.changes.emit()},Fe);function Fe(){this.changes=new a.EventEmitter}var ke=(je.prototype.getTextContent=function(t){var e=Array.from(t.nativeElement.childNodes).filter(function(t){return t.nodeType===t.TEXT_NODE}).pop();return e&&e.nodeValue?e.nodeValue.trim():""},je);function je(){}var Ae,Se=(c(Be,Ae=ke),Be.prototype.setLabelFromContent=function(){var t=this.getTextContent(this.elementRef);t&&!this.label&&(this.label=t)},Be.prototype.ngAfterContentInit=function(){this.setLabelFromContent()},Be.decorators=[{type:a.Component,args:[{selector:"sf-button",template:"<ng-content></ng-content>\n",providers:[{provide:ke,useExisting:a.forwardRef(function(){return Be})}]}]}],Be.ctorParameters=function(){return[{type:a.ElementRef}]},Be.propDecorators={id:[{type:a.Input}],label:[{type:a.Input}],widget:[{type:a.Input}],click:[{type:a.Output}]},Be);function Be(t){var e=Ae.call(this)||this;return e.elementRef=t,e.label="",e.click=new a.EventEmitter,e}var De,We="string",ze="object",qe="array",Me=(c(Ne,De=ke),Object.defineProperty(Ne.prototype,"path",{get:function(){return this.name?"/"+this.name:""},enumerable:!0,configurable:!0}),Ne.prototype.getButtons=function(){var i=this;return this.childButtons.map(function(t,e){if(!t.id){var r=Math.random().toString(16).substr(2,8);t.id=i.name+r+"_"+(e+1)}i.actionRegistry.register(t.id,t.click.emit.bind(t.click));var n={id:t.id,label:t.label};return t.widget&&(n.widget=t.widget),n})},Ne.prototype.getFieldsValidators=function(t){return t.reduce(function(t,e){return t.concat(e.getValidators())},[])},Ne.prototype.getFieldsSchema=function(t){var n=this;return t.reduce(function(t,e){switch(n.type){case qe:t.items=e.getSchema();break;default:t.properties||(t.properties={}),t.properties[e.name]=e.getSchema()}var r=e.getButtons();return 0<r.length&&(t.buttons=r),e.required&&(t.required||(t.required=[]),t.required.push(e.name)),t},{})},Ne);function Ne(){var t=null!==De&&De.apply(this,arguments)||this;return t.name="",t}var Le,Te=(c($e,Le=ke),$e.prototype.ngOnInit=function(){this.description=this.getTextContent(this.elementRef)},$e.decorators=[{type:a.Component,args:[{selector:"sf-item",template:"<ng-content></ng-content>\n"}]}],$e.ctorParameters=function(){return[{type:a.ElementRef}]},$e.propDecorators={value:[{type:a.Input}]},$e);function $e(t){var e=Le.call(this)||this;return e.elementRef=t,e}var He,Ue=(c(Je,He=Me),Je.prototype.getSchema=function(){var e=this,t=this.getFieldsSchema(this.childFields.filter(function(t){return t!==e})),r=t.properties,n=t.items,i=t.required,o=this.getOneOf(),a={type:this.type};this.title!==undefined&&(a.title=this.title),r!==undefined&&(a.properties=r),n!==undefined&&(a.items=n),i!==undefined&&(a.required=i),o!==undefined&&(a.oneOf=o),this.description!==undefined&&(a.description=this.description),this.placeholder!==undefined&&(a.placeholder=this.placeholder),this.format!==undefined&&(a.format=this.format),this.widget!==undefined&&(a.widget=this.widget),this.readOnly!==undefined&&(a.readOnly=this.readOnly);var s=this.getButtons();return 0<s.length&&(a.buttons=s),Object.assign(a,this.schema)},Je.prototype.getValidators=function(){var n=this,t=this.getFieldsValidators(this.childFields.filter(function(t){return t!==n})).map(function(t){var e=t.path,r=t.validator;return{path:n.path+e,validator:r}});return this.validator&&t.push({path:this.path,validator:this.validator}),t},Je.prototype.ngOnChanges=function(t){var e,r,n=Object.keys(t);if(0<n.length)try{for(var i=x(n),o=i.next();!o.done;o=i.next())if(!t[o.value].isFirstChange()){this.templateSchemaService.changed();break}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(e)throw e.error}}},Je.prototype.getOneOf=function(){if(0!==this.childItems.length){var t=this.childItems.map(function(t){var e=t.value,r=t.description;return Array.isArray(e)?{"enum":e,description:r}:{"enum":[e],description:r}});if(0!==t.length)return t}},Je.prototype.setTitleFromContent=function(){var t=this.getTextContent(this.elementRef);t&&!this.title&&(this.title=t)},Je.prototype.ngAfterContentInit=function(){var t=this;this.setTitleFromContent(),d.merge(this.childFields.changes,this.childItems.changes,this.childButtons.changes).subscribe(function(){return t.templateSchemaService.changed()})},Je.decorators=[{type:a.Component,args:[{selector:"sf-field",template:"<ng-content ></ng-content>\n"}]}],Je.ctorParameters=function(){return[{type:a.ElementRef},{type:Ee},{type:o}]},Je.propDecorators={childFields:[{type:a.ContentChildren,args:[Je]}],childItems:[{type:a.ContentChildren,args:[Te]}],childButtons:[{type:a.ContentChildren,args:[Se]}],name:[{type:a.Input}],type:[{type:a.Input}],format:[{type:a.Input}],required:[{type:a.Input}],readOnly:[{type:a.Input}],title:[{type:a.Input}],description:[{type:a.Input}],placeholder:[{type:a.Input}],widget:[{type:a.Input}],validator:[{type:a.Input}],schema:[{type:a.Input}]},Je);function Je(t,e,r){var n=He.call(this)||this;return n.elementRef=t,n.templateSchemaService=e,n.actionRegistry=r,n.type=We,n.schema={},n}var Ke,Xe=(c(Ge,Ke=Me),Ge.prototype.setFormDocumentSchema=function(t){var n=this;this.actionRegistry.clear(),this.validatorRegistry.clear();var e=this.getFieldsSchema(t);this.getFieldsValidators(t).forEach(function(t){var e=t.path,r=t.validator;n.validatorRegistry.register(e,r)});var r=this.formComponent.schema;this.formComponent.schema={type:ze,properties:e.properties},e.required&&0<e.required.length&&(this.formComponent.schema.requred=e.required);var i=this.getButtons();0<i.length&&(this.formComponent.schema.buttons=i),this.formComponent.ngOnChanges({schema:new a.SimpleChange(r,this.formComponent.schema,Boolean(r))})},Ge.prototype.ngAfterContentInit=function(){var t=this;0<this.childFields.length&&this.setFormDocumentSchema(this.childFields.toArray()),d.merge(this.childFields.changes,this.templateSchemaService.changes).subscribe(function(){t.terminatorService.destroy(),t.setFormDocumentSchema(t.childFields.toArray())})},Ge.decorators=[{type:a.Directive,args:[{selector:"sf-form[templateSchema]",providers:[Ee]}]}],Ge.ctorParameters=function(){return[{type:o},{type:R},{type:ot},{type:N},{type:Ee}]},Ge.propDecorators={childFields:[{type:a.ContentChildren,args:[Ue]}],childButtons:[{type:a.ContentChildren,args:[Se]}]},Ge);function Ge(t,e,r,n,i){var o=Ke.call(this)||this;return o.actionRegistry=t,o.validatorRegistry=e,o.formComponent=r,o.terminatorService=n,o.templateSchemaService=i,o}var Ye=(Ze.decorators=[{type:a.NgModule,args:[{imports:[n.CommonModule],declarations:[Xe,Ue,Se,Te],exports:[Xe,Ue,Se,Te]}]}],Ze);function Ze(){}t.FormComponent=ot,t.FormElementComponent=st,t.FormElementComponentAction=ct,t.WidgetChooserComponent=ht,t.WidgetRegistry=W,t.FormProperty=v,t.ArrayProperty=Pt,t.FormPropertyFactory=P,t.SchemaPreprocessor=_,t.ValidatorRegistry=R,t.ActionRegistry=o,t.BindingRegistry=F,t.SchemaValidatorFactory=j,t.ZSchemaValidatorFactory=B,t.WidgetFactory=q,t.TerminatorService=N,t.Widget=kt,t.ControlWidget=At,t.ArrayLayoutWidget=Dt,t.ObjectLayoutWidget=qt,t.ArrayWidget=Lt,t.ButtonWidget=$t,t.ObjectWidget=Jt,t.CheckboxWidget=Gt,t.FileWidget=Qt,t.IntegerWidget=re,t.TextAreaWidget=oe,t.RadioWidget=le,t.RangeWidget=he,t.SelectWidget=fe,t.StringWidget=ge,t.DefaultWidgetRegistry=Pe,t.DisableControlDirective=Ce,t.SchemaFormModule=Ve,t.TemplateSchemaModule=Ye,t.ɵj=Ie,t.ɵh=G,t.ɵi=Z,t.ɵa=it,t.ɵb=o,t.ɵe=F,t.ɵg=P,t.ɵf=_,t.ɵc=R,t.ɵd=T,t.ɵq=Se,t.ɵl=Me,t.ɵo=Ue,t.ɵp=Te,t.ɵm=ke,t.ɵk=Xe,t.ɵn=Ee,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-schema-form.umd.min.js.map